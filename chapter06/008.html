<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>chapter0608 sprites</title>
    <style type="text/css">
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
    <script src="../js/vendor/jquery-3.4.1.min.js"></script>
    <script src="../js/threejs/dat.gui.js"></script>
    <script src="../js/threejs/three.js"></script>
    <script src="../js/threejs/stats.js"></script>
    <script src="../js/threejs/OrbitControls.js"></script>
    <script src="../js/threejs/VTKLoader.js"></script>
</head>
<body>
<div id="Stats-output" style="position: absolute;top: 0;left: 0"></div>
<div id="WebGL-output"></div>
<script type="text/javascript">
    var scene, sceneOrtho, camera, cameraOrtho, renderer, stats;
    $(function () {
        initThreeJS();
    });

    function initThreeJS() {
        stats = initStats();

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 1.0);
        renderer.shadowMapEnabled = true;

        scene = new THREE.Scene();
        sceneOrtho = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 10000);
        cameraOrtho = new THREE.OrthographicCamera(0, window.innerWidth, window.innerHeight, 0, -10, 10);

        var orbit = new THREE.OrbitControls(camera, renderer.domElement);

        var ambientLight = new THREE.AmbientLight(0x0c0c0c);
        scene.add(ambientLight);

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(0, 60, 0);
        spotLight.castShadow = true;
        scene.add(spotLight);

        var spotLightHelper = new THREE.SpotLightHelper(spotLight);
        scene.add(spotLightHelper);

        var spotLight1 = new THREE.SpotLight(0xffffff);
        spotLight1.position.set(0, -60, 0);
        spotLight1.castShadow = true;
        scene.add(spotLight1);

        var spotLightHelper1 = new THREE.SpotLightHelper(spotLight1);
        scene.add(spotLightHelper1);

        var axisHelper = new THREE.AxisHelper(50);
        scene.add(axisHelper);


        camera.position.set(0, 0, 50);
        camera.lookAt(new THREE.Vector3(20, 30, 0));

        var material = new THREE.MeshNormalMaterial();
        var geom = new THREE.SphereGeometry(15, 20, 20);
        var mesh = new THREE.Mesh(geom, material);

        scene.add(mesh);

        var getTexture = function () {
            var texture = new THREE.ImageUtils.loadTexture("../assets/textures/particles/sprite-sheet.png");
            return texture;
        };

        var controls = new function () {
            this.size = 150;
            this.sprite = 0;
            this.transparent = true;
            this.opacity = 0.6;
            this.color = 0xffffff;
            this.rotateSystem = true;
            this.redraw = function () {
                sceneOrtho.children.forEach(function (child) {
                    if (child instanceof THREE.Sprite) sceneOrtho.remove(child);
                });
                createSprite(controls.size, controls.transparent, controls.opacity, controls.color, controls.sprite);
            };
        };

        var gui = new dat.GUI();
        gui.add(controls, 'sprite', 0, 4).step(1).onChange(controls.redraw);
        gui.add(controls, 'size', 0, 120).onChange(controls.redraw);
        gui.add(controls, 'transparent').onChange(controls.redraw);
        gui.add(controls, 'opacity', 0, 1).onChange(controls.redraw);
        gui.addColor(controls, 'color').onChange(controls.redraw);

        controls.redraw();


        function createSprite(size, transparent, opacity, color, spriteNumber) {
            var spriteMaterial = new THREE.SpriteMaterial({
                    opacity: opacity,
                    color: color,
                    transparent: transparent,
                    map: getTexture()
                }
            );
            // we have 1 row, with five sprites
            spriteMaterial.map.offset = new THREE.Vector2(0.2 * spriteNumber, 0);
            spriteMaterial.map.repeat = new THREE.Vector2(1 / 5, 1);
            spriteMaterial.depthTest = false;
            spriteMaterial.blending = THREE.AdditiveBlending;
            var sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(size, size, size);
            sprite.position.set(100, 50, -10);
            sprite.velocityX = 5;
            sceneOrtho.add(sprite);
        }

        $("#WebGL-output").append(renderer.domElement);

        render();

        var step = 1;

        function render() {
            stats.update();
            camera.position.y = Math.sin(step += 0.01) * 20;
            sceneOrtho.children.forEach(function (e) {
                if (e instanceof THREE.Sprite) {
                    // move the sprite along the bottom
                    e.position.x = e.position.x + e.velocityX;
                    if (e.position.x > window.innerWidth) {
                        e.velocityX = -5;
                        e.material.map.offset.set(1 / 5 * (controls.sprite % 4), 0);
                    }
                    if (e.position.x < 0) {
                        e.velocityX = 5;
                    }
                }
            });
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            renderer.autoClear = false;
            renderer.render(sceneOrtho, cameraOrtho);

        }
    }

    function initStats() {
        var thisStats = new Stats();
        thisStats.setMode(0);
        $("#Stats-output").append(thisStats.domElement);
        return thisStats;
    }
</script>
</body>
</html>